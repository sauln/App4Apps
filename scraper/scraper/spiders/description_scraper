import scrapy
from scraper.items import AppItem

class DescriptionScraper(scrapy.Spider):
    name = "dscrape"
    allowed_domains = ["play.google.com"]
    start_urls = [
            "https://play.google.com/store/apps/category/" + category.upper() + "/collection/topselling_paid", 
            "https://play.google.com/store/apps/category/" + category.upper() + "/collection/topselling_free"
    ]

    def parse(self, response):
        for href in response.xpath('//a[contains(@class, "title")]/[contains(@href, "/store/app/details")]/@href'):
            url = response.urljoin(href.extract())
            yield scrapy.Request(url, callback=self.parse_dir_contents)

    def parse_dir_contents(self, response):
        for sel in response.xpath('//*[contains(@class, "description")]'):
            item = AppItem()
            item['desc'] = sel.xpath('text()').extract()[0]
            print item['desc']
            try: 
                self.f.write(item['desc'] + '\n')
            except:
                continue
        self.urls_parsed += 1
        if self.urls_parsed > 1:
            self.f.close()